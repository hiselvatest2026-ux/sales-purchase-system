<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Sales & Purchase - UI</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:20px;background:#f7f7fb}
    .card{background:#fff;padding:16px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.06);margin-bottom:12px}
    input,select{padding:8px;margin:6px 0;width:100%}
    button{padding:8px 12px;margin-top:8px}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid #eee;padding:8px;text-align:left}
  </style>
</head>
<body>
  <h1>Sales & Purchase - Demo UI</h1>
  <div class="card">
    <h3>Add Vendor</h3>
    <input id="vendorName" placeholder="Vendor name"/>
    <input id="vendorContact" placeholder="Contact"/>
    <button onclick="addVendor()">Add Vendor</button>
  </div>

  <div class="card">
    <h3>Add Product</h3>
    <input id="productName" placeholder="Product name"/>
    <input id="productPrice" placeholder="Price" type="number"/>
    <select id="productVendor"></select>
    <button onclick="addProduct()">Add Product</button>
  </div>

  <div class="card">
    <h3>Vendors</h3>
    <table id="vendorsTable"><thead><tr><th>ID</th><th>Name</th><th>Contact</th></tr></thead><tbody></tbody></table>
  </div>

  <div class="card">
    <h3>Products</h3>
    <table id="productsTable"><thead><tr><th>ID</th><th>Name</th><th>Price</th><th>Vendor</th></tr></thead><tbody></tbody></table>
  </div>

<script>
async function fetchVendors(){
  const res = await fetch('/api/vendors');
  const data = await res.json();
  const tbody = document.querySelector('#vendorsTable tbody');
  tbody.innerHTML = '';
  const sel = document.getElementById('productVendor');
  sel.innerHTML = '<option value="">-- Select Vendor --</option>';
  data.forEach(v=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${v.id}</td><td>${v.name}</td><td>${v.contact||''}</td>`;
    tbody.appendChild(tr);
    const opt = document.createElement('option');
    opt.value = v.id; opt.textContent = v.name;
    sel.appendChild(opt);
  });
}

async function fetchProducts(){
  const res = await fetch('/api/products');
  const data = await res.json();
  const tbody = document.querySelector('#productsTable tbody');
  tbody.innerHTML = '';
  data.forEach(p=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${p.id}</td><td>${p.name}</td><td>${p.price}</td><td>${p.vendor_name||''}</td>`;
    tbody.appendChild(tr);
  });
}

async function addVendor(){
  const name = document.getElementById('vendorName').value;
  const contact = document.getElementById('vendorContact').value;
  if(!name) return alert('vendor name required');
  await fetch('/api/vendors',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,contact})});
  document.getElementById('vendorName').value=''; document.getElementById('vendorContact').value='';
  await fetchVendors(); await fetchProducts();
}

async function addProduct(){
  const name = document.getElementById('productName').value;
  const price = Number(document.getElementById('productPrice').value||0);
  const vendor_id = document.getElementById('productVendor').value || null;
  if(!name) return alert('product name required');
  await fetch('/api/products',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,price,vendor_id})});
  document.getElementById('productName').value=''; document.getElementById('productPrice').value='';
  await fetchProducts();
}

window.onload = async ()=>{ await fetchVendors(); await fetchProducts(); }
</script>
</body>
</html>
